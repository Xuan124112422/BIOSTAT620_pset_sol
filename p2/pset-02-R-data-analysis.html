<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="hongye xuan">

<title>NHANES Data Analysis</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="pset-02-R-data-analysis_files/libs/clipboard/clipboard.min.js"></script>
<script src="pset-02-R-data-analysis_files/libs/quarto-html/quarto.js"></script>
<script src="pset-02-R-data-analysis_files/libs/quarto-html/popper.min.js"></script>
<script src="pset-02-R-data-analysis_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="pset-02-R-data-analysis_files/libs/quarto-html/anchor.min.js"></script>
<link href="pset-02-R-data-analysis_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="pset-02-R-data-analysis_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="pset-02-R-data-analysis_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="pset-02-R-data-analysis_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="pset-02-R-data-analysis_files/libs/bootstrap/bootstrap-8a79a254b8e706d3c925cde0a310d4f0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">


</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">NHANES Data Analysis</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>hongye xuan </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<section id="set-global-options-for-quarto-document" class="level1">
<h1>Set global options for Quarto document</h1>
<p>knitr::opts_chunk$set(echo = TRUE, eval = TRUE, warning = FALSE, message = FALSE)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Load required libraries</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)   <span class="co"># For data manipulation</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>
载入程序包：'dplyr'</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:stats':

    filter, lag</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>The following objects are masked from 'package:base':

    intersect, setdiff, setequal, union</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyr)   <span class="co"># For data tidying</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(forcats) <span class="co"># For factor manipulation</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2) <span class="co"># For data visualization</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(knitr)   <span class="co"># For table formatting</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(NHANES)  <span class="co"># Dataset for analysis</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter NHANES data for survey year 2011_12 and assign to 'dat'</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> NHANES <span class="sc">|&gt;</span> </span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">SurveyYr =</span> <span class="fu">as.character</span>(SurveyYr)) <span class="sc">|&gt;</span>  <span class="co"># Convert SurveyYr to character</span></span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(SurveyYr <span class="sc">==</span> <span class="st">"2011_12"</span>)  <span class="co"># Filter for the correct survey year</span></span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the first few rows of the filtered dataset</span></span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 76
     ID SurveyYr Gender   Age AgeDecade AgeMonths Race1 Race3 Education   
  &lt;int&gt; &lt;chr&gt;    &lt;fct&gt;  &lt;int&gt; &lt;fct&gt;         &lt;int&gt; &lt;fct&gt; &lt;fct&gt; &lt;fct&gt;       
1 62163 2011_12  male      14 " 10-19"         NA Other Asian &lt;NA&gt;        
2 62172 2011_12  female    43 " 40-49"         NA Black Black High School 
3 62174 2011_12  male      80  &lt;NA&gt;            NA White White College Grad
4 62174 2011_12  male      80  &lt;NA&gt;            NA White White College Grad
5 62175 2011_12  male       5 " 0-9"           NA White White &lt;NA&gt;        
6 62176 2011_12  female    34 " 30-39"         NA White White College Grad
# ℹ 67 more variables: MaritalStatus &lt;fct&gt;, HHIncome &lt;fct&gt;, HHIncomeMid &lt;int&gt;,
#   Poverty &lt;dbl&gt;, HomeRooms &lt;int&gt;, HomeOwn &lt;fct&gt;, Work &lt;fct&gt;, Weight &lt;dbl&gt;,
#   Length &lt;dbl&gt;, HeadCirc &lt;dbl&gt;, Height &lt;dbl&gt;, BMI &lt;dbl&gt;,
#   BMICatUnder20yrs &lt;fct&gt;, BMI_WHO &lt;fct&gt;, Pulse &lt;int&gt;, BPSysAve &lt;int&gt;,
#   BPDiaAve &lt;int&gt;, BPSys1 &lt;int&gt;, BPDia1 &lt;int&gt;, BPSys2 &lt;int&gt;, BPDia2 &lt;int&gt;,
#   BPSys3 &lt;int&gt;, BPDia3 &lt;int&gt;, Testosterone &lt;dbl&gt;, DirectChol &lt;dbl&gt;,
#   TotChol &lt;dbl&gt;, UrineVol1 &lt;int&gt;, UrineFlow1 &lt;dbl&gt;, UrineVol2 &lt;int&gt;, …</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate that the resulting table has 5000 rows and 76 columns</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="fu">all</span>(<span class="fu">dim</span>(dat) <span class="sc">==</span> <span class="fu">c</span>(<span class="dv">5000</span>, <span class="dv">76</span>))) {</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="st">"Validation successful: The table has 5000 rows and 76 columns."</span>)</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>} <span class="cf">else</span> {</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">print</span>(<span class="fu">paste</span>(<span class="st">"Validation failed: Dimensions are"</span>, <span class="fu">paste</span>(<span class="fu">dim</span>(dat), <span class="at">collapse =</span> <span class="st">" x "</span>)))</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "Validation successful: The table has 5000 rows and 76 columns."</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Validate that the resulting table has 5000 rows and 76 columns</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Optionally, display a summary of the filtered dataset</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       ID          SurveyYr            Gender          Age       
 Min.   :62163   Length:5000        female:2495   Min.   : 0.00  
 1st Qu.:64544   Class :character   male  :2505   1st Qu.:17.00  
 Median :67039   Mode  :character                 Median :36.00  
 Mean   :67028                                    Mean   :36.71  
 3rd Qu.:69509                                    3rd Qu.:54.00  
 Max.   :71915                                    Max.   :80.00  
                                                                 
   AgeDecade      AgeMonths          Race1           Race3     
  0-9   : 709   Min.   : 0.00   Black   : 589   Asian   : 288  
  10-19 : 704   1st Qu.: 4.00   Hispanic: 350   Black   : 589  
  50-59 : 690   Median :11.00   Mexican : 480   Hispanic: 350  
  20-29 : 672   Mean   :11.64   White   :3135   Mexican : 480  
  40-49 : 670   3rd Qu.:20.00   Other   : 446   White   :3135  
 (Other):1378   Max.   :23.00                   Other   : 158  
 NA's   : 177   NA's   :4882                                   
          Education         MaritalStatus         HHIncome     HHIncomeMid    
 8th Grade     : 212   Divorced    : 352   more 99999 :1161   Min.   :  2500  
 9 - 11th Grade: 405   LivePartner : 294   75000-99999: 524   1st Qu.: 30000  
 High School   : 679   Married     :1896   25000-34999: 471   Median : 50000  
 Some College  :1160   NeverMarried: 737   35000-44999: 441   Mean   : 57078  
 College Grad  :1128   Separated   :  84   45000-54999: 373   3rd Qu.:100000  
 NA's          :1416   Widowed     : 222   (Other)    :1653   Max.   :100000  
                       NA's        :1415   NA's       : 377   NA's   :377     
    Poverty        HomeRooms       HomeOwn             Work     
 Min.   :0.000   Min.   : 1.000   Own  :3076   Looking   : 166  
 1st Qu.:1.190   1st Qu.: 4.000   Rent :1777   NotWorking:1413  
 Median :2.600   Median : 6.000   Other: 119   Working   :2263  
 Mean   :2.761   Mean   : 6.193   NA's :  28   NA's      :1158  
 3rd Qu.:4.760   3rd Qu.: 8.000                                 
 Max.   :5.000   Max.   :13.000                                 
 NA's   :325     NA's   :28                                     
     Weight           Length          HeadCirc         Height     
 Min.   :  3.60   Min.   : 50.30   Min.   :36.80   Min.   : 83.8  
 1st Qu.: 55.40   1st Qu.: 77.85   1st Qu.:39.50   1st Qu.:156.5  
 Median : 72.10   Median : 88.40   Median :41.10   Median :165.6  
 Mean   : 70.33   Mean   : 86.44   Mean   :40.99   Mean   :161.5  
 3rd Qu.: 88.10   3rd Qu.: 97.30   3rd Qu.:42.40   3rd Qu.:174.2  
 Max.   :198.70   Max.   :112.20   Max.   :45.00   Max.   :200.4  
 NA's   :31       NA's   :4725     NA's   :4959    NA's   :159    
      BMI           BMICatUnder20yrs         BMI_WHO         Pulse       
 Min.   :12.90   UnderWeight:  55    12.0_18.5   : 677   Min.   : 40.00  
 1st Qu.:21.50   NormWeight : 805    18.5_to_24.9:1487   1st Qu.: 66.00  
 Median :25.80   OverWeight : 193    25.0_to_29.9:1319   Median : 72.00  
 Mean   :26.44   Obese      : 221    30.0_plus   :1338   Mean   : 73.63  
 3rd Qu.:30.60   NA's       :3726    NA's        : 179   3rd Qu.: 82.00  
 Max.   :80.60                                           Max.   :136.00  
 NA's   :166                                             NA's   :718     
    BPSysAve        BPDiaAve         BPSys1          BPDia1     
 Min.   : 79.0   Min.   :  0.0   Min.   : 74.0   Min.   :  0.0  
 1st Qu.:107.0   1st Qu.: 62.0   1st Qu.:108.0   1st Qu.: 62.0  
 Median :116.0   Median : 69.0   Median :116.0   Median : 70.0  
 Mean   :118.7   Mean   : 68.3   Mean   :119.3   Mean   : 68.9  
 3rd Qu.:128.0   3rd Qu.: 77.0   3rd Qu.:128.0   3rd Qu.: 78.0  
 Max.   :221.0   Max.   :116.0   Max.   :224.0   Max.   :110.0  
 NA's   :719     NA's   :719     NA's   :893     NA's   :893    
     BPSys2          BPDia2           BPSys3          BPDia3      
 Min.   : 78.0   Min.   :  0.00   Min.   : 78.0   Min.   :  0.00  
 1st Qu.:106.0   1st Qu.: 62.00   1st Qu.:106.0   1st Qu.: 62.00  
 Median :116.0   Median : 70.00   Median :116.0   Median : 70.00  
 Mean   :118.9   Mean   : 68.36   Mean   :118.5   Mean   : 68.12  
 3rd Qu.:128.0   3rd Qu.: 78.00   3rd Qu.:128.0   3rd Qu.: 78.00  
 Max.   :226.0   Max.   :116.00   Max.   :216.0   Max.   :116.00  
 NA's   :797     NA's   :797      NA's   :788     NA's   :788     
  Testosterone       DirectChol       TotChol         UrineVol1    
 Min.   :   0.25   Min.   :0.410   Min.   : 1.530   Min.   :  1.0  
 1st Qu.:  17.70   1st Qu.:1.090   1st Qu.: 4.060   1st Qu.: 46.0  
 Median :  43.82   Median :1.290   Median : 4.730   Median : 88.0  
 Mean   : 197.90   Mean   :1.361   Mean   : 4.831   Mean   :112.4  
 3rd Qu.: 362.41   3rd Qu.:1.580   3rd Qu.: 5.510   3rd Qu.:156.0  
 Max.   :1795.60   Max.   :4.030   Max.   :12.280   Max.   :446.0  
 NA's   :874       NA's   :775     NA's   :775      NA's   :501    
   UrineFlow1        UrineVol2       UrineFlow2    Diabetes     DiabetesAge   
 Min.   : 0.0070   Min.   :  0.0   Min.   :0.000   No  :4563   Min.   : 1.00  
 1st Qu.: 0.3940   1st Qu.: 54.0   1st Qu.:0.500   Yes : 373   1st Qu.:39.00  
 Median : 0.6740   Median :102.0   Median :0.770   NA's:  64   Median :50.00  
 Mean   : 0.9584   Mean   :125.1   Mean   :1.165               Mean   :47.61  
 3rd Qu.: 1.1940   3rd Qu.:173.0   3rd Qu.:1.531               3rd Qu.:57.00  
 Max.   :17.1670   Max.   :409.0   Max.   :7.200               Max.   :80.00  
 NA's   :790       NA's   :4179    NA's   :4179                NA's   :4693   
     HealthGen    DaysPhysHlthBad  DaysMentHlthBad  LittleInterest
 Excellent: 486   Min.   : 0.000   Min.   : 0.000   None   :2601  
 Vgood    :1278   1st Qu.: 0.000   1st Qu.: 0.000   Several: 513  
 Good     :1485   Median : 0.000   Median : 0.000   Most   : 221  
 Fair     : 472   Mean   : 3.048   Mean   : 3.822   NA's   :1665  
 Poor     :  77   3rd Qu.: 2.000   3rd Qu.: 3.000                 
 NA's     :1202   Max.   :30.000   Max.   :30.000                 
                  NA's   :1206     NA's   :1204                   
   Depressed     nPregnancies       nBabies         Age1stBaby   
 None   :2647   Min.   : 1.000   Min.   : 0.000   Min.   :14.00  
 Several: 479   1st Qu.: 2.000   1st Qu.: 2.000   1st Qu.:19.00  
 Most   : 210   Median : 3.000   Median : 2.000   Median :22.00  
 NA's   :1664   Mean   : 2.924   Mean   : 2.375   Mean   :22.66  
                3rd Qu.: 4.000   3rd Qu.: 3.000   3rd Qu.:26.00  
                Max.   :13.000   Max.   :11.000   Max.   :39.00  
                NA's   :3735     NA's   :3832     NA's   :4108   
 SleepHrsNight    SleepTrouble PhysActive  PhysActiveDays       TVHrsDay   
 Min.   : 2.000   No  :2824    No  :1778   Min.   :1.000   2_hr     :1275  
 1st Qu.: 6.000   Yes :1019    Yes :2372   1st Qu.:2.000   1_hr     : 884  
 Median : 7.000   NA's:1157    NA's: 850   Median :4.000   3_hr     : 836  
 Mean   : 6.906                            Mean   :3.819   0_to_1_hr: 638  
 3rd Qu.: 8.000                            3rd Qu.:5.000   More_4_hr: 615  
 Max.   :12.000                            Max.   :7.000   (Other)  : 611  
 NA's   :1166                              NA's   :2614    NA's     : 141  
     CompHrsDay   TVHrsDayChild  CompHrsDayChild Alcohol12PlusYr
 0_to_1_hr:1409   Min.   : NA    Min.   : NA     No  : 693      
 0_hrs    :1073   1st Qu.: NA    1st Qu.: NA     Yes :2657      
 1_hr     :1030   Median : NA    Median : NA     NA's:1650      
 2_hr     : 589   Mean   :NaN    Mean   :NaN                    
 3_hr     : 347   3rd Qu.: NA    3rd Qu.: NA                    
 (Other)  : 415   Max.   : NA    Max.   : NA                    
 NA's     : 137   NA's   :5000   NA's   :5000                   
   AlcoholDay      AlcoholYear     SmokeNow    Smoke100         Smoke100n   
 Min.   : 1.000   Min.   :  0.00   No  : 862   No  :2027   Non-Smoker:2027  
 1st Qu.: 1.000   1st Qu.:  3.00   Yes : 698   Yes :1560   Smoker    :1560  
 Median : 2.000   Median : 24.00   NA's:3440   NA's:1413   NA's      :1413  
 Mean   : 2.925   Mean   : 74.86                                            
 3rd Qu.: 3.000   3rd Qu.:104.00                                            
 Max.   :82.000   Max.   :364.00                                            
 NA's   :2503     NA's   :2016                                              
    SmokeAge     Marijuana   AgeFirstMarij   RegularMarij  AgeRegMarij   
 Min.   : 6.00   No  : 989   Min.   : 1.00   No  :1757    Min.   :10.00  
 1st Qu.:15.00   Yes :1454   1st Qu.:15.00   Yes : 686    1st Qu.:15.00  
 Median :17.00   NA's:2557   Median :16.00   NA's:2557    Median :17.00  
 Mean   :17.86               Mean   :17.12                Mean   :18.01  
 3rd Qu.:19.00               3rd Qu.:19.00                3rd Qu.:19.00  
 Max.   :72.00               Max.   :48.00                Max.   :52.00  
 NA's   :3488                NA's   :3546                 NA's   :4314   
 HardDrugs   SexEver         SexAge      SexNumPartnLife   SexNumPartYear  
 No  :2333   No  : 111   Min.   : 9.00   Min.   :   0.00   Min.   : 0.000  
 Yes : 549   Yes :2773   1st Qu.:15.00   1st Qu.:   2.00   1st Qu.: 1.000  
 NA's:2118   NA's:2116   Median :17.00   Median :   5.00   Median : 1.000  
                         Mean   :17.51   Mean   :  16.55   Mean   : 1.375  
                         3rd Qu.:19.00   3rd Qu.:  12.00   3rd Qu.: 1.000  
                         Max.   :47.00   Max.   :2000.00   Max.   :69.000  
                         NA's   :2227    NA's   :2135      NA's   :2561    
 SameSex          SexOrientation  PregnantNow  
 No  :2667   Bisexual    :  56   Yes    :  24  
 Yes : 217   Heterosexual:2290   No     : 754  
 NA's:2116   Homosexual  :  56   Unknown:  27  
             NA's        :2598   NA's   :4195  
                                               
                                               
                                               </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Compute average and SD of BPSysAve by Gender</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>gender_summary <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> </span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Gender) <span class="sc">|&gt;</span>  <span class="co"># Group by Gender</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">average =</span> <span class="fu">mean</span>(BPSysAve, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Compute mean of BPSysAve</span></span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">SD =</span> <span class="fu">sd</span>(BPSysAve, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Compute standard deviation of BPSysAve</span></span>
<span id="cb12-7"><a href="#cb12-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>  <span class="co"># Drop grouping to avoid warning</span></span>
<span id="cb12-8"><a href="#cb12-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb12-9"><a href="#cb12-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-10"><a href="#cb12-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result as a table</span></span>
<span id="cb12-11"><a href="#cb12-11" aria-hidden="true" tabindex="-1"></a>gender_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 2 × 3
  Gender average    SD
  &lt;fct&gt;    &lt;dbl&gt; &lt;dbl&gt;
1 female    117.  18.1
2 male      120.  16.5</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute average and SD of BPSysAve by Race3 and Gender</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a>race_gender_summary <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> </span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Gender, Race3) <span class="sc">|&gt;</span>  <span class="co"># Group by Gender and Race3</span></span>
<span id="cb14-4"><a href="#cb14-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb14-5"><a href="#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">average =</span> <span class="fu">mean</span>(BPSysAve, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Compute mean of BPSysAve</span></span>
<span id="cb14-6"><a href="#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">SD =</span> <span class="fu">sd</span>(BPSysAve, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Compute standard deviation of BPSysAve</span></span>
<span id="cb14-7"><a href="#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>  <span class="co"># Drop grouping to avoid warning</span></span>
<span id="cb14-8"><a href="#cb14-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb14-9"><a href="#cb14-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(average))  <span class="co"># Sort by average in descending order</span></span>
<span id="cb14-10"><a href="#cb14-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-11"><a href="#cb14-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result as a table</span></span>
<span id="cb14-12"><a href="#cb14-12" aria-hidden="true" tabindex="-1"></a>race_gender_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 4
   Gender Race3    average    SD
   &lt;fct&gt;  &lt;fct&gt;      &lt;dbl&gt; &lt;dbl&gt;
 1 male   Black       122.  19.1
 2 male   White       121.  16.5
 3 male   Other       121.  14.0
 4 female Black       120.  19.1
 5 male   Hispanic    120.  14.5
 6 male   Asian       118.  15.3
 7 female White       118.  18.0
 8 male   Mexican     116.  15.1
 9 female Hispanic    114.  19.2
10 female Other       114.  17.6
11 female Asian       114.  17.6
12 female Mexican     111.  14.9</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Add 95% confidence intervals</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>race_gender_ci <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> </span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Gender, Race3) <span class="sc">|&gt;</span>  <span class="co"># Group by Gender and Race3</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">average =</span> <span class="fu">mean</span>(BPSysAve, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Compute mean of BPSysAve</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">SD =</span> <span class="fu">sd</span>(BPSysAve, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Compute standard deviation of BPSysAve</span></span>
<span id="cb16-7"><a href="#cb16-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(BPSysAve)),  <span class="co"># Count non-NA values</span></span>
<span id="cb16-8"><a href="#cb16-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> average <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> SD <span class="sc">/</span> <span class="fu">sqrt</span>(n),  <span class="co"># Lower bound of CI</span></span>
<span id="cb16-9"><a href="#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> average <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> SD <span class="sc">/</span> <span class="fu">sqrt</span>(n),  <span class="co"># Upper bound of CI</span></span>
<span id="cb16-10"><a href="#cb16-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>  <span class="co"># Drop grouping to avoid warning</span></span>
<span id="cb16-11"><a href="#cb16-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb16-12"><a href="#cb16-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(<span class="fu">desc</span>(average))  <span class="co"># Sort by average in descending order</span></span>
<span id="cb16-13"><a href="#cb16-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-14"><a href="#cb16-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result as a table</span></span>
<span id="cb16-15"><a href="#cb16-15" aria-hidden="true" tabindex="-1"></a>race_gender_ci</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 12 × 7
   Gender Race3    average    SD     n lower upper
   &lt;fct&gt;  &lt;fct&gt;      &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
 1 male   Black       122.  19.1   244  120.  125.
 2 male   White       121.  16.5  1361  120.  122.
 3 male   Other       121.  14.0    69  118.  124.
 4 female Black       120.  19.1   241  117.  122.
 5 male   Hispanic    120.  14.5   128  117.  122.
 6 male   Asian       118.  15.3   120  116.  121.
 7 female White       118.  18.0  1417  117.  119.
 8 male   Mexican     116.  15.1   221  114.  118.
 9 female Hispanic    114.  19.2   145  111.  117.
10 female Other       114.  17.6    53  109.  119.
11 female Asian       114.  17.6   122  111.  117.
12 female Mexican     111.  14.9   160  109.  114.</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co">#  Create a plot with averages and confidence intervals</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-4"><a href="#cb18-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(race_gender_ci, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(Race3, average), <span class="at">y =</span> average, <span class="at">color =</span> Race3)) <span class="sc">+</span></span>
<span id="cb18-5"><a href="#cb18-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span>  <span class="co"># Add points for averages</span></span>
<span id="cb18-6"><a href="#cb18-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span>  <span class="co"># Add error bars</span></span>
<span id="cb18-7"><a href="#cb18-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Gender) <span class="sc">+</span>  <span class="co"># Create separate panels for each Gender</span></span>
<span id="cb18-8"><a href="#cb18-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb18-9"><a href="#cb18-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Comparing Systolic Blood Pressure Across Groups"</span>,</span>
<span id="cb18-10"><a href="#cb18-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Race"</span>, </span>
<span id="cb18-11"><a href="#cb18-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average"</span>,</span>
<span id="cb18-12"><a href="#cb18-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Bars represent 95% confidence intervals"</span></span>
<span id="cb18-13"><a href="#cb18-13" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()  <span class="co"># Use a clean minimal theme</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="pset-02-R-data-analysis_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a histogram of Age by Race3 and Gender</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> Age, <span class="at">fill =</span> Race3)) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">5</span>, <span class="at">position =</span> <span class="st">"identity"</span>, <span class="at">alpha =</span> <span class="fl">0.6</span>) <span class="sc">+</span>  <span class="co"># Bin width of 5 years</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Gender <span class="sc">~</span> Race3, <span class="at">scales =</span> <span class="st">"free_y"</span>) <span class="sc">+</span>  <span class="co"># Separate by Gender and Race3; free Y-scale</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Age Distribution by Race3 and Gender"</span>,</span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age (years)"</span>,</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Count"</span>,</span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">"Each row represents a Gender; Y-scales are free for each facet"</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">"bottom"</span>)  <span class="co"># Place legend at the bottom</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="pset-02-R-data-analysis_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Discussion:</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co"># The histogram shows clear differences in age distributions across Race3 groups:</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1. White: The age distribution is skewed towards older age groups, with a significant proportion of individuals aged 40 years and above. This pattern is consistent for both males and females.</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2. Mexican: The age distribution is skewed towards younger age groups, with most individuals below the age of 30. There is a noticeable decline in representation among older cohorts (60 years and above).</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 3. Hispanic: The distribution appears more balanced but still leans younger compared to the White population.</span></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Implications:</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a><span class="co"># - Age is likely a confounder in the relationship between Race3 and systolic blood pressure (SBP). The higher SBP observed in the White group may be attributed to their older age profile rather than intrinsic differences.</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a><span class="co"># - Conversely, the younger age profile of the Mexican group likely explains their comparatively lower SBP levels.</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="co">#</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Suggestions for Further Analysis:</span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="co"># - Stratify by age groups to compare SBP within similar age brackets across Race3 groups.</span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="co"># - Incorporate age as a covariate in a regression model to adjust for its confounding effects.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute median age and percent under 18 by Race3</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>age_summary <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> </span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Race3) <span class="sc">|&gt;</span>  <span class="co"># Group by Race3</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">median_age =</span> <span class="fu">median</span>(Age, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Calculate median age</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">children =</span> <span class="dv">100</span> <span class="sc">*</span> <span class="fu">mean</span>(Age <span class="sc">&lt;</span> <span class="dv">18</span>, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Calculate percentage of individuals under 18</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>  <span class="co"># Drop grouping to avoid warning</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(median_age)  <span class="co"># Order by median age in ascending order</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>age_summary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 6 × 3
  Race3    median_age children
  &lt;fct&gt;         &lt;dbl&gt;    &lt;dbl&gt;
1 Mexican        22.5     40  
2 Other          22.5     38.0
3 Hispanic       28.5     31.4
4 Black          33       29.2
5 Asian          35       25.3
6 White          41       21.9</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute average BPS by AgeDecade, Race3, and Gender</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>bps_summary <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> </span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(AgeDecade) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(BPSysAve)) <span class="sc">|&gt;</span>  <span class="co"># Remove rows with missing AgeDecade or BPSysAve</span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Gender, AgeDecade, Race3) <span class="sc">|&gt;</span>  <span class="co"># Group by Gender, AgeDecade, and Race3</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">average_bps =</span> <span class="fu">mean</span>(BPSysAve, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Calculate the average BPS</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>  <span class="co"># Drop grouping to avoid warnings</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bps_summary, <span class="fu">aes</span>(<span class="at">x =</span> AgeDecade, <span class="at">y =</span> average_bps, <span class="at">color =</span> Race3, <span class="at">group =</span> Race3)) <span class="sc">+</span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> <span class="dv">1</span>) <span class="sc">+</span>  <span class="co"># Use linewidth instead of size</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span>  <span class="co"># Add points for average BPS</span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Gender) <span class="sc">+</span>  <span class="co"># Create separate plots for males and females</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average BPS by Age Decade and Race Group"</span>,</span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age Decade"</span>,</span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average BPS"</span>,</span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Race Group"</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))  <span class="co"># Rotate x-axis labels for better readability</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="pset-02-R-data-analysis_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Filter data for two groups (e.g., White and Mexican)</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>selected_groups <span class="ot">&lt;-</span> bps_summary <span class="sc">|&gt;</span> </span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Race3 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Mexican"</span>))  <span class="co"># Replace with chosen groups</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute confidence intervals for the selected groups</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>bps_with_ci <span class="ot">&lt;-</span> dat <span class="sc">|&gt;</span> </span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(AgeDecade) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(BPSysAve) <span class="sc">&amp;</span> Race3 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Mexican"</span>)) <span class="sc">|&gt;</span>  <span class="co"># Filter for selected groups</span></span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(Gender, AgeDecade, Race3) <span class="sc">|&gt;</span>  <span class="co"># Group by Gender, AgeDecade, and Race3</span></span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">average_bps =</span> <span class="fu">mean</span>(BPSysAve, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Calculate mean BPS</span></span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">SD =</span> <span class="fu">sd</span>(BPSysAve, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),  <span class="co"># Standard deviation</span></span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">n =</span> <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(BPSysAve)),  <span class="co"># Count non-NA observations</span></span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>    <span class="at">lower =</span> average_bps <span class="sc">-</span> <span class="fl">1.96</span> <span class="sc">*</span> SD <span class="sc">/</span> <span class="fu">sqrt</span>(n),  <span class="co"># Lower bound of CI</span></span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">upper =</span> average_bps <span class="sc">+</span> <span class="fl">1.96</span> <span class="sc">*</span> SD <span class="sc">/</span> <span class="fu">sqrt</span>(n),  <span class="co"># Upper bound of CI</span></span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">.groups =</span> <span class="st">"drop"</span>  <span class="co"># Drop grouping to avoid warning</span></span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a plot with confidence intervals</span></span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(bps_with_ci, <span class="fu">aes</span>(<span class="at">x =</span> AgeDecade, <span class="at">y =</span> average_bps, <span class="at">color =</span> Race3)) <span class="sc">+</span></span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>), <span class="at">size =</span> <span class="dv">3</span>) <span class="sc">+</span>  <span class="co"># Add points, dodge for separation</span></span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> lower, <span class="at">ymax =</span> upper), <span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="at">width =</span> <span class="fl">0.5</span>), <span class="at">width =</span> <span class="fl">0.2</span>) <span class="sc">+</span>  <span class="co"># Add error bars</span></span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span> Gender) <span class="sc">+</span>  <span class="co"># Separate by Gender</span></span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb24-24"><a href="#cb24-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">title =</span> <span class="st">"Average BPS with Confidence Intervals (White vs. Mexican)"</span>,</span>
<span id="cb24-25"><a href="#cb24-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">"Age Decade"</span>,</span>
<span id="cb24-26"><a href="#cb24-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">y =</span> <span class="st">"Average BPS"</span>,</span>
<span id="cb24-27"><a href="#cb24-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">"Race Group"</span></span>
<span id="cb24-28"><a href="#cb24-28" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb24-29"><a href="#cb24-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="pset-02-R-data-analysis_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Compute the difference in average SBP between the two groups for each age stratum</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>sbp_difference <span class="ot">&lt;-</span> bps_summary <span class="sc">|&gt;</span> </span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Race3 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"White"</span>, <span class="st">"Mexican"</span>)) <span class="sc">|&gt;</span>  <span class="co"># Filter for the selected groups</span></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> Race3, </span>
<span id="cb25-6"><a href="#cb25-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> average_bps, </span>
<span id="cb25-7"><a href="#cb25-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"SBP_"</span></span>
<span id="cb25-8"><a href="#cb25-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span>  <span class="co"># Reshape data to create separate columns for White and Mexican</span></span>
<span id="cb25-9"><a href="#cb25-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb25-10"><a href="#cb25-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">difference =</span> SBP_White <span class="sc">-</span> SBP_Mexican  <span class="co"># Compute difference between the two groups</span></span>
<span id="cb25-11"><a href="#cb25-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span> </span>
<span id="cb25-12"><a href="#cb25-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(Gender, AgeDecade, difference) <span class="sc">|&gt;</span>  <span class="co"># Keep only relevant columns</span></span>
<span id="cb25-13"><a href="#cb25-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(</span>
<span id="cb25-14"><a href="#cb25-14" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_from =</span> Gender, </span>
<span id="cb25-15"><a href="#cb25-15" aria-hidden="true" tabindex="-1"></a>    <span class="at">values_from =</span> difference, </span>
<span id="cb25-16"><a href="#cb25-16" aria-hidden="true" tabindex="-1"></a>    <span class="at">names_prefix =</span> <span class="st">"Difference_"</span></span>
<span id="cb25-17"><a href="#cb25-17" aria-hidden="true" tabindex="-1"></a>  )  <span class="co"># Reshape to create separate columns for males and females</span></span>
<span id="cb25-18"><a href="#cb25-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-19"><a href="#cb25-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Display the result</span></span>
<span id="cb25-20"><a href="#cb25-20" aria-hidden="true" tabindex="-1"></a>sbp_difference</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 8 × 3
  AgeDecade Difference_female Difference_male
  &lt;fct&gt;                 &lt;dbl&gt;           &lt;dbl&gt;
1 " 0-9"               -4.33            4.94 
2 " 10-19"              2.18           -3.32 
3 " 20-29"              3.25            2.36 
4 " 30-39"             -2.27           -0.229
5 " 40-49"             -1.61            0.383
6 " 50-59"              0.881           2.57 
7 " 60-69"              1.31           -2.34 
8 " 70+"               -5.74            7.13 </code></pre>
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>